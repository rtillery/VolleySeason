<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Knights Volleyball Academy 15 Adidas Maroon (KVA15AM)</title>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="tabletop.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.1.2/css/fixedHeader.dataTables.min.css">
<style type="text/css">

td.details-control {
    text-align:center;
    color:forestgreen;
    cursor: pointer;
}
tr.shown td.details-control {
    text-align:center; 
    color:red;
}
body {
    font-family: sans-serif;
}

.ourteamname {
    font-size: 3vmin;
}

/* Height of table rows */
tr {
    height: 4vmin;
}

/* Height of table heading font */
.dataTable th {
    font-size: 3vmin;
}

/* Height of table row font */
.dataTable td {
    font-size: 2.5vmin;
}

/* Detail table row font */
.set td {
    font-size: 2vmin;
}

.team {
    color: blue;
    font-weight: bold;
}
.percent, .win, .lose, .tie {
    color: white;
    font-weight: bold;
    text-align: right;
}
.win {
    background-color: limegreen;
}
.lose {
    background-color: red;
}
.tie {
    background-color: gold;
}
.us_won, .us_lost {
    text-align: center;
}
.invisible {
    visibility: hidden;
}
.loading {
    position: fixed;
    z-index: 999;
    height: 25vmin;
    width: 25vmin;
    overflow: show;
    margin: auto;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
}

@media (pointer: coarse),
       (-moz-touch-enabled) {
    /* Height of table rows */
    tr {
        height: 10vmin;
    }
    
    /* Height of table heading font */
    .dataTable th {
        font-size: 4vmin;
    }
    
    /* Height of table row font */
    .dataTable td {
        font-size: 4vmin;
    }
    
    /* Detail table row font */
    .set td {
        font-size: 3.5vmin;
    }
}
  
</style>
</head>

<body>
<div class='ourteamname'>
Knights Volleyball Academy 15 Adidas Maroon (KVA15AM)
</div>
<div>
    <table id="teamtable" class="display invisible" style="width:100%">
        <thead>
            <tr>
                <th></th>
                <th>Team</th>
                <th>%</th>
                <th>Us</th>
                <th>Them</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th>Team</th>
                <th>%</th>
                <th>Us</th>
                <th>Them</th>
            </tr>
        </tfoot>
    </table>
</div>

<script type='text/javascript'>
    TEAMSHEET = "Sheet3";
    SETSHEET = "Sheet1";

    function winlosetie(us, them) {
        var iUs = parseInt(us);
        var iThem = parseInt(them);
        return (iUs > iThem) ? 'win' : ((iUs < iThem) ? 'lose' : 'tie');
    }

    function format ( d ) {
        // `d` is the original data object for the row
        console.log(d);
        sets = setsheet.elements;
        console.log(sets);
        console.log(d["Team"]);
        var setarray = $.grep(sets, function(e){ return e.Opponent == d["Team"]; });
        console.log(setarray);
        detailtable = '<table class=\'sets\' cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
            '<thead><tr><th>Tournament</th><th>Date</th><th>Round</th><th>Us</th><th>Them</th></tr></thead>';
        $.each(setarray, function( index, value ) {
            var tdwlt = "<td class='" + winlosetie(value["Us"], value["Them"]) + " dt-center'>";
            detailtable += '<tr class=\'set\'>'+
                '<td>' + value["Tournament"] + '</td>'+
                '<td class=\'dt-center\'>' + value["Date"] + '</td>'+
                '<td>' + value["Round"] + '</td>'+
                tdwlt + value["Us"] + '</td>'+
                tdwlt + value["Them"] + '</td>'+
            '</tr>';
        });
        detailtable += '</table>';
        return detailtable;
    }
    
    $(document).ready(function() {
        $("body").prepend('<i class="fas fa-volleyball-ball fa-spin loading" style="font-size:25vmin"></i>');

        Tabletop.init( { key: "https://docs.google.com/spreadsheets/d/1-VoIO4Wjer8G1XTJcf74jXJGi4-Jqedjiye5bux_K2s/pubhtml",
                         callback: showDataTable,
                         wanted: [ SETSHEET, TEAMSHEET ] } );
    } );
    
    function showDataTable(dataarray, tabletop) {
        $("#teamtable").removeClass('invisible');
        $(".loading").remove();

        teamsheet = dataarray[TEAMSHEET];
        setsheet = dataarray[SETSHEET];
        results = teamsheet.elements;
        overall = results[0];
        results.splice(0, 1);
        var table = $('#teamtable').DataTable( {
            "data": results,
            fixedColumns:   {
                heightMatch: 'none'
            },
            columns: [
                {
                    "className": 'details-control',
                    "orderable": false,
                    "data": null,
                    "defaultContent": '',
                    "render": function () {
                        return '<i class="fa fa-plus-square" aria-hidden="true"></i>';
                    },
                    width:"1.5em"
                },
                { "data": 'Team' },
                { "data": 'Percent',
                  "width": '2em' },
                { "data": 'Us',
                  "width": '1.5em',
                  "className": 'dt-center' },
                { "data": 'Them',
                  "width": '1.5em',
                  "className": 'dt-center' }
            ],
            paging: false,
            searching: false,
            scrollY: false,
            fixedHeader: {
                header: true,
                footer: true
            },
            rowCallback: function(row, data, index) {
                $(row).find('td:eq(2)').addClass(winlosetie(data["Us"], data["Them"]));
            },
            "order": [[1, 'asc']]
        } );

        $("body").css("cursor", "default");

        // Add event listener for opening and closing details
        $('#teamtable tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row( tr );
     
            if ( row.child.isShown() ) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                // Open this row
                row.child( format(row.data()) ).show();
                tr.addClass('shown');
            }
        } );
    }
</script>

</body>
</html>
