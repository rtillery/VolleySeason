<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0'>

<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.2.0/css/all.css' integrity='sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ' crossorigin='anonymous'>

<script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
<script type='text/javascript' src='tabletop.min.js'></script>
<script type='text/javascript' src='https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js'></script>
<script type='text/javascript' language='javascript' src='https://cdn.datatables.net/fixedheader/3.1.5/js/dataTables.fixedHeader.min.js'></script>

<link rel='stylesheet' type='text/css' href='https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css'>
<link rel='stylesheet' type='text/css' href='https://cdn.datatables.net/fixedheader/3.1.2/css/fixedHeader.dataTables.min.css'>
<link rel='stylesheet' type='text/css' href='style.css'>

<style>

.white {
  stroke: white;
  fill: none;
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 14px;
}

#masthead {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}
.club, .team {
  font-family: 'Enter-Sansman-Bold-Italic';
  background-color: white;
  letter-spacing: -.05em;
}
.club {
  font-size: 30px;
  color: #555;
  padding: 6px;
  display: block; /* no team: centered */
}
.withteam {
  display: inline-block; /* landscape to the left */
}
.team {
  font-size: 22px;
  color: maroon;
  padding: 2px;
  display: inline-block; /* always centered */
}
a .team {
  font-size: 9vmin;
}
.team span, .club span {
  transform: scaleX(.75);
  font-size: 85%;
  letter-spacing: normal;
}

.navbar {
  background-color: #555;
  width: 9em;
  float: left;
}
.navbar a {
  color: white;
  text-decoration: none;
  display: list-item;
  padding: 1em .5em;
}
.navbar a svg {
  display: inline-block;
  vertical-align: middle;
  width: 18px;
  height: 14px;
}
.icon, .net {
  width: 1em;
  float: left;
  top: .15em;
  position: relative;
}
.icon {
  stroke-width: 3;
}
.net {
  stroke-width: 1.5;
}

.home {
  background-color: darkgray;
}

.active {
  background-color: maroon;
}

#txtteams:before {
  content: "Teams";
}
#txtplayers:before {
  content: "Players";
}
#txttourneys:before {
  content: "Tournaments";
}
#txtfoes:before {
  content: "Opponents";
}
#txtpics:before {
  content: "Photos";
}

#teampage {
  margin-left: 9em;
  background-color: lightgray;
}

.teamlist {
  list-style-type: none;
  padding: 0;
  background-color: white;
}
.teamlist a {
  text-decoration: none;
}
.teamlist a .team {
  text-align: left;
}

@media screen and (max-aspect-ratio: 1/1) {
  #masthead {
    flex-direction: column;
  }
  .club, .team {
    display: block;
  }
  .withteam {
    display: block; /* portrait centered */
  }

  .navbar {
    width: 100%;
    float: none;
    font-size: 0;
  }
  .navbar div {
    font-size: 3.9vmin;
    display: inline-block;
    padding: 10px 5px;
  }
  .navbar a {
    color: white;
    text-decoration: none;
    display: inline-block;
    padding: 0;
  }
  .navbar a svg {
    display: inline-block;
    vertical-align: middle;
    width: 3.2vmin;
    height: 3.2vmin;
  }

  #txtteams:before {
    content: "Teams";
  }
  #txtplayers:before {
    content: "Players";
  }
  #txttourneys:before {
    content: "Tourneys";
  }
  .narrow {
    font-size: 66.7%;
    transform: scaleY(1.5);
  }
  #txtfoes:before {
    content: "Foes";
  }
  #txtpics:before {
    content: "Pics";
  }

  #teampage {
    margin-left: 0;
  }
}

</style>

<svg width='0' height='0' style='display: block'>
  <defs>
    <symbol id='bracket'>
      <path class='white icon' d='M32,16h-11m-10,-10h10v20h-10m-10,5h10v-10h-10m0,-20h10v10h-10' />
    </symbol>

    <symbol class='white net' id='net'>
      <path d='M1,5c5,2 26,2 30,0M1,8c5,2 26,2 30,0M1,11c5,2 26,2 30,0M1,14c5,2 26,2 30,0' />
      <path d='M1,4v21m-2,0h4M31,4v21m-2,0h4' />
      <path d='M4,5.9v9M7,6v9M10,6.2v9M13,6.6v9M16,6.6v9M19,6.6v9M22,6.2v9M25,6v9M28,5.9v9' />
    </symbol>
  </defs>
</svg>

</head>
<body>

<div id='masthead'>
  <div class='club'><div class='cond'>K<span>NIGHTS</span> V<span>OLLEYBALL</span> A<span>CADEMY</span></div></div>
<!--  <div id='team' class='team invisible'></div> -->
</div>

<div class='navbar'>
  <div id='teamstab' class='home active'><a href='#'><i class='fa fa-fw fa-home'></i> <span id='txtteams' /></a></div>
  <div id='tourneystab' class='invisible'><a href='#'><svg width='3.2vmin' height='3.2vmin' viewbox='0 0 32 32'><use x='0' y='0' xlink:href='#bracket' /></svg> <span id='txttourneys' /></a></div>
  <div id='foestab' class='invisible'><a href='#'><svg width='3.2vmin' height='3.2vmin' viewbox='0 0 32 32'><use x='0' y='0' xlink:href='#net' /></svg> <span id='txtfoes' /></a></div>
  <div id='playerstab' class='invisible'><a href='#'><i class='fa fa-fw fa-user'></i> <span id='txtplayers' /></a></div>
  <div id='picstab' class='invisible'><a href='#'><i class='fa fa-fw fa-camera'></i> <span id='txtpics' /></a></div>
</div>

<div id='teampage'>
  <div style='padding: .75em'>
    <ul class='teamlist'>
    </ul>
  </div>
</div>

<div id='foespage' class='invisible'>
</div>

<div id='tourneyspage' class='invisible'>
</div>

<div id='playerspage' class='invisible'>
</div>

<div id='picspage' class='invisible'>
</div>

<script type='text/javascript'>
  TEAMSHEETKEY = "https://docs.google.com/spreadsheets/d/17B2Rt7nFdFIpI2Be0otmxB_qr_hwVSkG505d7pQ2sNA/pubhtml";
  TEAMSHEETSHEET = "Sheet1";

  function isWhiteSpace(chr) {
    return (" \t\r\n\v\f".indexOf(chr) >= 0);
  }
  function isDigit(chr) {
    return (chr >= '0' && chr <= '9');
  }
  function isAlpha(chr) {
    return ((chr >= 'a' && chr <= 'z') || (chr >= 'A' && chr <= 'Z'));
  }
  function SmallCaps(instr) {
    var outstr = "";
    var i = 0;
    var looking = true;
    var chr = instr.charAt(i);
    while (chr) {
      i++;
      if (looking) {
        if (!isAlpha(chr) || isWhiteSpace(chr)) {
          outstr += chr;
        } else {
          looking = false;
          outstr += chr;
          outstr += "<span>";
        }
      } else {
        if (  isWhiteSpace(chr)) {
          outstr += "</span>";
          outstr += chr;
          looking = true;
        } else {
          outstr += chr.toUpperCase();
        }
      }
      chr = instr.charAt(i);
    }
    if (!looking)
      outstr += "</span>";
    return outstr;
  }

  function GetCleanURL() {
    return window.location.protocol + "//" + window.location.hostname + window.location.pathname;
  }

  function DisplayTeamList() {
    // Replace existing list with empty one
    var teamlistobj = $('ul.teamlist');
    // Populate with items from the team list, setting the link to the current URL
    // plus the teamid
    $.each(teamlist, function(index, value) {
      var team = $('<li/>')
                 .appendTo(teamlistobj);
      var lnk = $("<a href='" + GetCleanURL() + "?teamid=" + value.USAVCode + "'/>")
                .html(value.TeamName)
                .appendTo(team);
    });
  }

  // Collect URL parameters whenever the URL changes
  // From: https://stackoverflow.com/a/2880929
  var urlParams = {};
  (window.onpopstate = function() {
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function(s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = window.location.search.substring(1);

    while (match = search.exec(query))
      urlParams[decode(match[1])] = decode(match[2]);
  })();

  // Set up page to get list of teams (with their USAV code & results sheet
  // key) from team sheet, when it has completed loading.
  $(document).ready(function() {
    // Busy spinner
    $('body').prepend("<i class='fas fa-volleyball-ball fa-spin loading' style='font-size:25vmin'></i>");

    // Set Teams tab to reload page with no specified teamid
    $('#teamstab a').attr('href', GetCleanURL());

    // Get contents of team sheet and call specified callback function with the data
    Tabletop.init( {
      key: TEAMSHEETKEY,
      callback: showDataTable,
      wanted: [TEAMSHEETSHEET]
    });
  });

  // Display the list of teams in a clickable list
  function showDataTable(dataarray, tabletop) {
    // Start by getting the list of teams from the team spreadsheet
    teamlist = dataarray[TEAMSHEETSHEET].elements;

    // Decorate the team names for desired display (either in list or in masthead)
    $.each(teamlist, function(index, value) {
      teamlist[index].TeamName = "<div class='team'>" + SmallCaps(value.TeamName) + "</div>";
    });

    // If the URL contains no teamid, then set up the selection list
    if (!urlParams.teamid) {
      DisplayTeamList();
    // Otherwise, if the teamid matches one of the ones in the team list,
    // use the accompanying key to obtain that team's season data.
    } else {
      // Find the matching team
      teamrow = teamlist.find(x => x.USAVCode === urlParams.teamid);
      // If the teamid is unknown, reload the page using the URL without it
      if (!teamrow) {
        document.location.href = GetCleanURL();
      } else {
        // Otherwise, use the team info

        // Switch the 
        $('.club').addClass('withteam');
        $('#masthead').append("<div id='team' class='team'>" + teamrow.TeamName + "</div>");
        $('.navbar div').removeClass('invisible');
        $('#teamstab').removeClass('active');
        $('#foestab').addClass('active');
      }
    }

    // Clear busy spinner
    $('.loading').remove();

//        var table = $('#teamtable').DataTable( {
//            'data': teamlist,
//            fixedColumns:   {
//                'heightMatch': 'none'
//            },
//            columns: [
//                { 'className': 'details-control',
//                  'orderable': false,
//                  'data': null,
//                  'defaultContent': '',
//                  'render': function () {
//                      return "<i class='fa fa-plus-square' aria-hidden='true'></i>";
//                  },
//                  'width':'6mm' },
//                { 'data': 'OpponentName' },
//                { 'data': 'LatestRanking',
//                  'width': '9mm',
//                  'className': 'dt-center',
//                  'type': 'custom' },
//                { 'data': 'Percent',
//                  'width': '9mm' },
//                { 'data': 'Wins',
//                  'width': '9mm',
//                  'className': 'dt-center' },
//                { 'data': 'Losses',
//                  'width': '9mm',
//                  'className': 'dt-center' }
//            ],
//            paging: false,
//            searching: false,
//            fixedHeader: {
//                header: true,
//                footer: false
//            },
//            rowCallback: function(row, data, index) {
//                var tester = $(row).find('td:eq(3)');
//                if (tester.hasClass('win') || tester.hasClass('lose') || tester.hasClass('tie') || tester.hasClass('unplayed'))
//                    return;
//                $(row).find('td:eq(1)').wrapInner("<div class='cond'></div>");
//                $(row).find('td:eq(3)').addClass(winlosetie(data["Wins"], data["Losses"]));
//            },
//            'order': [[1, 'asc']]
//        } );

    $('body').css('cursor', 'default');
  }

</script>

</body>
</html> 
